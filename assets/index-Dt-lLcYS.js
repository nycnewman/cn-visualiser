var G=Object.defineProperty;var $=(t,s,n)=>s in t?G(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var f=(t,s,n)=>$(t,typeof s!="symbol"?s+"":s,n);import{j as e,a9 as v,r as h,aa as K,ab as X}from"./vendor-BJVJsBd_.js";import{c as Y,i as E,T as Q,A as V,a as q,I as D,M as ee,b as x,C as te,L as ne,d as se,D as re,B as ie,e as ae,P as y,f as k,g as N,h as j,j as l,k as A,K as ce,l as oe,m as le,n as R,o as b,p as _}from"./@mui-Bkofh40m.js";import{L as P,u as de,B as he,R as ue,a as O}from"./@react-router-QwG8io0z.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();function xe(t){return typeof t=="object"&&t!==null&&"message"in t&&typeof t.message=="string"}function je(t){if(xe(t))return t;try{return new Error(JSON.stringify(t))}catch{return new Error(String(t))}}function U(t){return je(t).message}const pe=Y({palette:{primary:{main:E[500]},secondary:{main:E[700]}}});function fe(){return e.jsx(Q,{theme:pe,children:e.jsx(V,{position:"static",children:e.jsxs(q,{children:[e.jsx(D,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},children:e.jsx(P,{to:"/cn-visualiser/",children:e.jsx(ee,{})})}),e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:'Canton Network Scan "Updates" Visualiser'})]})})})}const m=t=>e.jsx(te,{children:e.jsxs(ne,{dateAdapter:se,children:[e.jsx(fe,{}),t.children]})}),ge={recordDate:new Date("2024-06-24T21:08:34.404896Z"),updateState:t=>{}},I=v.createContext(ge);var C=class extends Error{constructor(s){super(s.statusText);f(this,"headers");f(this,"url");f(this,"status");f(this,"statusText");f(this,"data");Object.setPrototypeOf(this,new.target.prototype),this.headers=s.headers,this.url=s.url,this.status=s.status,this.statusText=s.statusText,this.data=s.data}},B=t=>t==="post"||t==="put"||t==="patch"||t==="delete";function me(t){const s=[],n=(i,r)=>`${encodeURIComponent(i)}=${encodeURIComponent(String(r))}`;return Object.keys(t).forEach(i=>{const r=t[i];r!=null&&(Array.isArray(r)?r.forEach(a=>s.push(n(i,a))):s.push(n(i,r)))}),s.length>0?`?${s.join("&")}`:""}function ve(t,s){return t.replace(/\{([^}]+)\}/g,(n,i)=>{const r=encodeURIComponent(s[i]);return delete s[i],r})}function ye(t,s,n){let i={};return B(t)?n.forEach(r=>{i[r]=s[r],delete s[r]}):i={...s},me(i)}function be(t,s){const n=new Headers(s);return t!==void 0&&!n.has("Content-Type")&&n.append("Content-Type","application/json"),n.has("Accept")||n.append("Accept","application/json"),n}function _e(t,s){const n=B(t)?JSON.stringify(s):void 0;return t==="delete"&&n==="{}"?void 0:n}function we(t,s){const n=new Headers(t==null?void 0:t.headers),i=new Headers(s==null?void 0:s.headers);for(const r of i.keys()){const a=i.get(r);a!=null&&n.set(r,a)}return{...t,...s,headers:n}}function Te(t){var o;const s=Object.assign(Array.isArray(t.payload)?[]:{},t.payload),n=ve(t.path,s),i=ye(t.method,s,t.queryParams),r=_e(t.method,s),a=be(r,(o=t.init)==null?void 0:o.headers),c=t.baseUrl+n+i,d={...t.init,method:t.method.toUpperCase(),headers:a,body:r};return{url:c,init:d}}async function Se(t){const s=t.headers.get("content-type");if(t.status===204||t.status===304)return;if(s&&s.indexOf("application/json")!==-1)return await t.json();const n=await t.text();try{return JSON.parse(n)}catch{return n}}async function Ce(t,s){const n=await fetch(t,s),i=await Se(n),r={headers:n.headers,url:n.url,ok:n.ok,status:n.status,statusText:n.statusText,data:i};if(r.ok)return r;throw new C(r)}function Ee(t,s){const n=async(i,r,a)=>{if(t==null||i===t.length)return s(r,a);const c=t[i];return await c(r,a,(d,o)=>n(i+1,d,o))};return(i,r)=>n(0,i,r)}async function Oe(t){const{url:s,init:n}=Te(t);return await t.fetch(s,n)}function De(t){const s=async(n,i)=>{try{return await t(n,i)}catch(r){throw r instanceof C?new s.Error(r):r}};return s.Error=class extends C{constructor(n){super(n),Object.setPrototypeOf(this,new.target.prototype)}getActualType(){return{status:this.status,data:this.data}}},s}function ke(){let t="",s={};const n=[],i=Ee(n,Ce);return{configure:r=>{t=r.baseUrl||"",s=r.init||{},n.splice(0),n.push(...r.use||[])},use:r=>n.push(r),path:r=>({method:a=>({create:c=>De((d,o)=>Oe({baseUrl:(o==null?void 0:o.baseUrl)??(typeof t=="function"?t():t),path:r,method:a,queryParams:Object.keys(c||{}),payload:d,init:we(s,o),fetch:i}))})})}}var L={for:()=>ke()};function Ne(t){return t.events_by_id!==void 0}function Ae(t){return t.create_arguments!==void 0}async function Re(t){const s=L.for();s.configure({baseUrl:"https://scan.sv-2.global.canton.network.digitalasset.com/api/scan",init:{headers:{Accept:"application/json"},signal:AbortSignal.timeout(5e3)}});const n=s.path("/v1/updates/{update_id}").method("get").create(),{data:i}=await n({update_id:t});return i}async function Pe(t){const s=L.for();try{s.configure({baseUrl:"https://scan.sv-2.global.canton.network.digitalasset.com/api/scan",init:{headers:{Accept:"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(5e3)}});const n=s.path("/v1/updates").method("post").create();try{const{data:i}=await n(t);if(i)return i.transactions}catch(i){if(i instanceof n.Error){const r=i.getActualType();console.error("Error getting updates:",r),(r.status===400||r.status===500)&&console.error(r.data)}}}catch(n){throw console.error("An error occurred:",n),n}}function Ue(t){const{row:s}=t,[n,i]=v.useState(!1);return e.jsxs(v.Fragment,{children:[e.jsxs(j,{sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(l,{children:e.jsx(D,{"aria-label":"expand row",size:"small",onClick:()=>i(!n),children:n?e.jsx(ce,{}):e.jsx(oe,{})})}),e.jsx(l,{component:"th",scope:"row",children:e.jsx(P,{to:"/cn-visualiser/"+s.update_id,children:s.update_id})}),e.jsx(l,{align:"right",children:s.total_events}),e.jsx(l,{align:"right",children:s.migration_id}),e.jsx(l,{align:"right",children:s.record_time})]}),e.jsx(j,{children:e.jsx(l,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:e.jsx(le,{in:n,timeout:"auto",unmountOnExit:!0,children:e.jsxs(R,{sx:{margin:1},children:[e.jsx(x,{variant:"h6",gutterBottom:!0,component:"div",children:"Event(s)"}),e.jsxs(k,{size:"small","aria-label":"purchases",children:[e.jsx(N,{children:e.jsxs(j,{children:[e.jsx(l,{children:"Event ID"}),e.jsx(l,{children:"Event Type"}),e.jsx(l,{children:"Template"}),e.jsx(l,{children:"Choice"})]})}),e.jsx(A,{children:s.events.map(r=>e.jsxs(j,{children:[e.jsx(l,{component:"th",scope:"row",children:r.event_id.split(":")[1]}),e.jsx(l,{children:r.event_type}),e.jsx(l,{children:r.template_id.split(":")[1]+":"+r.template_id.split(":")[2]}),e.jsx(l,{children:r.event_type==="exercised_event"&&r.choice})]},r.event_id))})]})]})})})})]})}function Ie(t){let s=[];for(const n in t.events_by_id){const i=t.events_by_id[n];s.push(i)}return s.sort((n,i)=>{const r=Number(n.event_id.split(":")[1]),a=Number(i.event_id.split(":")[1]);return r<a?-1:r>a?1:0}),{update_id:t.update_id,migration_id:t.migration_id,record_time:t.record_time,events:s,total_events:Object.keys(t.events_by_id).length}}const Be=()=>{const[t,s]=h.useState(void 0),[n,i]=h.useState(!0),[r,a]=h.useState(void 0),{recordDate:c,updateState:d}=h.useContext(I),[o,p]=h.useState(!0);if(h.useEffect(()=>{(async()=>{if(o)try{i(!0),a(""),p(!1);const g={0:{min:"2024-06-24T21:08:34.404896Z",max:"2024-10-16T13:00:18.826299Z"},1:{min:"2024-10-16T13:24:18.493744Z",max:"2024-12-11T14:00:17.064286Z"},2:{min:"2024-12-11T14:23:05.779294Z",max:"2025-05-23T19:02:45.315646Z"}};let S=0;if(c==null)return[];c>=new Date(g[2].min)?S=2:c>=new Date(g[1].min)&&(S=1);const H={after:{after_record_time:c.toISOString(),after_migration_id:S},page_size:25,daml_value_encoding:"compact_json"},Z=await Pe(H);s(Z)}catch(g){a(U(g))}finally{i(!1)}})()},[o,c]),r)return e.jsx(m,{children:e.jsxs("p",{children:["Errors occurred: ",r]})});let w;t?w=t.map(u=>Ie(u)):w=[];const W=u=>{Object.prototype.toString.call(u)==="[object Date]"&&(u==null||d({recordDate:u}))},J=()=>{c&&p(!0)},z=()=>{t!=null&&(d({recordDate:new Date(t[t.length-1].record_time.toString())}),p(!0))};return e.jsxs(m,{children:[e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsx("div",{children:'This application allows you to search and view Canton Network Scan "Updates". You need to use from a machine with access to Canton Network Scan service.'})}),e.jsx("p",{}),e.jsxs(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:["Enter Record Datetime to search for:",e.jsx(re,{label:"Date and Time",value:c,onChange:W,onAccept:J,ampm:!1,format:"yyyy-MM-dd HH:mm:ss"}),"  ",e.jsx(ie,{variant:"contained",onClick:z,children:"Next Page"})]}),e.jsx(ae,{component:y,children:e.jsxs(k,{"aria-label":"collapsible table",children:[e.jsx(N,{children:e.jsxs(j,{children:[e.jsx(l,{}),e.jsx(l,{children:"Update ID#"}),e.jsx(l,{align:"right",children:"Event Count"}),e.jsx(l,{align:"right",children:"Migration ID"}),e.jsx(l,{align:"right",children:"Date"})]})}),e.jsxs(A,{children:[n&&e.jsx(j,{children:e.jsx(l,{colSpan:4,align:"center",children:"Loading..."})}),r&&e.jsx(j,{children:e.jsxs(l,{colSpan:4,align:"center",children:["ERROR: Error occurred: ... ",r," "]})}),w&&w.map(u=>e.jsx(Ue,{row:u},u.update_id))]})]})})]})},Le=(t={x:0,y:0})=>{const[s,n]=h.useState(t),[i,r]=h.useState({width:0,height:0}),a=h.useCallback(c=>{if(c!==null){const{width:d,height:o}=c.getBoundingClientRect();r({width:d,height:o}),n({x:d/2-400,y:o/2})}},[]);return[i,s,a]},Fe=({nodeDatum:t,toggleNode:s})=>{var n,i,r,a,c,d,o,p;return e.jsxs("g",{children:[e.jsx("rect",{width:"15",height:"15",x:"-5",onClick:s}),e.jsx("text",{fill:"black",strokeWidth:"1",x:"0",dy:"40",children:t.name}),t.attributes&&((n=t.attributes)==null?void 0:n.type)&&e.jsxs("text",{fill:"black",x:"20",dy:"60",strokeWidth:"1",children:["Type: ",(i=t.attributes)==null?void 0:i.type]}),t.attributes&&((r=t.attributes)==null?void 0:r.update_id)&&e.jsxs("text",{fill:"black",x:"20",dy:"60",strokeWidth:"1",children:["Upd ID: ",(a=t.attributes)==null?void 0:a.update_id]}),t.attributes&&((c=t.attributes)==null?void 0:c.template)&&e.jsxs("text",{fill:"black",x:"20",dy:"80",strokeWidth:"1",children:["Template: ",(d=t.attributes)==null?void 0:d.template]}),t.attributes&&((o=t.attributes)==null?void 0:o.choice)&&e.jsxs("text",{fill:"black",x:"20",dy:"100",strokeWidth:"1",children:["Choice: ",(p=t.attributes)==null?void 0:p.choice]})]})},F=(t,s)=>{const n=s[t],r={name:t.substring(0,10)+"....."+t.substring(t.length-10),attributes:{},children:[]};return r.attributes={},r.attributes.type=n.event_type,r.attributes.template=n.template_id.substring(n.template_id.indexOf(":")+1),n.event_type=="exercised_event"&&(r.attributes.choice=n.choice),n.child_event_ids!==void 0&&(r.children=n.child_event_ids.map(a=>F(a,s))),r},Me=t=>{var n;const s={name:"TX Root",children:[],attributes:{update_id:t.update_id.substring(0,10)+"....."+t.update_id.substring(t.update_id.length-10)}};if(typeof t.root_event_ids!==void 0){const i=t;s.children=(n=i.root_event_ids)==null?void 0:n.map(r=>F(r,i.events_by_id))}return s},We=({source:t,target:s})=>{const n=t.y,i=t.x+10,r=s.y,a=s.x+10;return`M${n},${i}L${r},${a}`},Je=t=>{const[s,n,i]=Le(),r={width:"1000px",height:"600px",border:"2px solid gray"},a=Me(t.transaction);return e.jsx("div",{style:r,ref:i,children:e.jsx(K,{data:a,dimensions:s,translate:n,nodeSize:{x:350,y:150},renderCustomNodeElement:Fe,orientation:"horizontal",pathFunc:We})})};function ze(t){const[s,n]=h.useState(!1);function i(){n(r=>!r)}return e.jsxs("div",{children:[e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsxs("div",{onClick:i,children:["Raw JSON ",e.jsx("strong",{children:"(click to show/hide)"})]})}),s&&e.jsx("pre",{children:JSON.stringify(t.transaction,null,2)}),e.jsx("p",{}),e.jsx("p",{}),e.jsx("p",{})]})}const T=t=>{if(typeof t.field=="string")return e.jsxs("li",{children:['"',t.field,'"']},t.field);let s;const n=[];for(s in t.field){const i=t.field[s];switch(typeof t.field[s]){case"string":typeof i=="string"&&n.push(e.jsxs("li",{children:[e.jsx("em",{children:s}),": ",i]},s));break;case"boolean":n.push(e.jsxs("li",{children:[e.jsx("em",{children:s}),": ",i?"True":"False"]},s));break;case"object":n.push(e.jsxs("li",{children:[e.jsx("em",{children:s}),": ",e.jsx("ul",{children:e.jsx(T,{field:i})})]},s));break;default:n.push(e.jsx("li",{children:"Unknown Field Type"},s));break}}return n},M=t=>{var s,n,i,r;if(Ae(t.events[t.id])){const a=t.events[t.id];return e.jsx(y,{elevation:2,children:e.jsx(b,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsx("div",{children:e.jsxs("strong",{children:['"',t.id,'": ',a.event_type,"  "]})}),e.jsxs("div",{children:["Package: ",a.template_id]}),e.jsxs("div",{children:["Created At: ",a.created_at]}),e.jsx("div",{children:"Signatories:"}),e.jsxs("ul",{children:[a.signatories.length==0&&e.jsx("li",{children:"None"}),a.signatories&&((s=a.signatories)==null?void 0:s.map(c=>e.jsx("li",{children:c},c)))]}),e.jsx("div",{children:"Observers:"}),e.jsxs("ul",{children:[a.observers.length==0&&e.jsx("li",{children:"None"}),a.observers&&((n=a.observers)==null?void 0:n.map(c=>e.jsx("li",{children:c},c)))]}),e.jsx("div",{children:"Create Arguments: "}),e.jsx("ul",{children:e.jsx(T,{field:a.create_arguments})})]})})})}else{const a=t.events[t.id];return e.jsx(y,{elevation:2,children:e.jsx(b,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsx("div",{children:e.jsxs("strong",{children:[t.id,": ",a.event_type," "]})}),e.jsxs("div",{children:["Package: ",a.template_id]}),e.jsxs("div",{children:["Consuming: ",e.jsx("strong",{children:a.consuming?e.jsx(e.Fragment,{children:"True"}):e.jsx(e.Fragment,{children:"False"})})]}),e.jsx("div",{children:"Acting Parties:"}),e.jsxs("ul",{children:[a.acting_parties.length==0&&e.jsx("li",{children:"None"}),a.acting_parties&&((i=a.acting_parties)==null?void 0:i.map(c=>e.jsx("li",{children:c},c)))]}),e.jsxs("div",{children:["Choice: ",e.jsx("strong",{children:a.choice})]}),e.jsx("div",{children:"Choice Arguments: "}),e.jsx("ul",{children:e.jsx(T,{field:a.choice_argument})}),e.jsx("div",{children:"Exercise Result: "}),e.jsx("ul",{children:e.jsx(T,{field:a.exercise_result})}),e.jsx("div",{children:"Child Events:"}),e.jsxs("ul",{children:[a.child_event_ids.length==0&&e.jsx("li",{children:"None"}),a.child_event_ids&&((r=a.child_event_ids)==null?void 0:r.map(c=>e.jsx("div",{className:"list-row",children:e.jsx("li",{children:e.jsx(M,{id:c,events:t.events},c)})},c)))]})]})})})}},He=t=>{var s;if(Ne(t.transaction)){const n=t.transaction;return e.jsx(y,{elevation:2,children:e.jsx(b,{sx:{minWidth:275},children:e.jsx(_,{children:e.jsxs("div",{className:"box-with-outline",children:[e.jsxs(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:[e.jsx("label",{children:e.jsx("strong",{children:"Transaction:"})}),e.jsx("p",{})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Update ID:"})," ",n.update_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Workflow ID:"})," ",n.workflow_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Record Time:"})," ",n.record_time]}),e.jsxs("div",{children:[e.jsx("label",{children:"Migration ID:"})," ",n.migration_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Synchronizer ID:"})," ",n.synchronizer_id]}),e.jsx("p",{}),n.root_event_ids&&((s=n.root_event_ids)==null?void 0:s.map(i=>e.jsx("div",{className:"list-row",children:e.jsx(M,{id:i,events:n.events_by_id},i)},i)))]})})})})}else{const n=t.transaction;return e.jsxs("div",{children:["TODO:  To be Handled ",n.update_id]})}},Ze=()=>{const[t,s]=h.useState(),{update_id:n}=de(),[i,r]=v.useState(""),[a,c]=v.useState(!1);return h.useEffect(()=>{(async()=>{c(!0),r("");try{let o;typeof n=="string"&&(o=await Re(n),s(o))}catch(o){r("ERROR: Error retrieving data from service: "+U(o))}finally{c(!1)}})()},[n]),a?e.jsx(m,{children:e.jsx("p",{children:"Loading data..."})}):i?e.jsx(m,{children:e.jsxs("p",{children:["Error: ",i]})}):e.jsxs(m,{children:[e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsx("strong",{children:"Transaction Details Page"})}),e.jsx(R,{sx:{display:"flex",flexWrap:"wrap","& > :not(style)":{m:1}},children:e.jsx(y,{children:e.jsx(b,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsxs(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:[e.jsx("strong",{children:"Details for Update ID: "}),n]}),e.jsx("p",{}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{transaction:t}),e.jsx(b,{sx:{minWidth:275},children:e.jsx(_,{children:e.jsx(ze,{transaction:t})})}),e.jsx(He,{transaction:t})]})]})})})})]})},Ge=()=>e.jsx(he,{children:e.jsxs(ue,{children:[e.jsx(O,{path:"/cn-visualiser",element:e.jsx(Be,{})}),e.jsx(O,{path:"/cn-visualiser/:update_id",element:e.jsx(Ze,{})})]})}),$e=t=>{const[s,n]=h.useState({recordDate:new Date("2024-06-24T00:00:00.000000Z")}),i=r=>{r.recordDate&&n({recordDate:r.recordDate})};return e.jsx(I.Provider,{value:{...s,updateState:i},children:t.children})};X.createRoot(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx($e,{children:e.jsx(Ge,{})})}));
