var Z=Object.defineProperty;var G=(t,s,n)=>s in t?Z(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var j=(t,s,n)=>G(t,typeof s!="symbol"?s+"":s,n);import{j as e,a9 as v,r as h,aa as $,ab as K}from"./vendor-BJVJsBd_.js";import{c as X,i as O,T as Y,A as Q,a as V,I as k,M as q,b as x,C as ee,L as te,d as ne,D as se,e as re,P as y,f as D,g as N,h as p,j as l,k as A,K as ie,l as ae,m as ce,B as U,n as b,o as _}from"./@mui-CEW2xLgA.js";import{L as P,u as oe,B as le,R as de,a as E}from"./@react-router-QwG8io0z.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();function he(t){return typeof t=="object"&&t!==null&&"message"in t&&typeof t.message=="string"}function ue(t){if(he(t))return t;try{return new Error(JSON.stringify(t))}catch{return new Error(String(t))}}function R(t){return ue(t).message}const xe=X({palette:{primary:{main:O[500]},secondary:{main:O[700]}}});function je(){return e.jsx(Y,{theme:xe,children:e.jsx(Q,{position:"static",children:e.jsxs(V,{children:[e.jsx(k,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},children:e.jsx(P,{to:"/cn-visualiser/",children:e.jsx(q,{})})}),e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:'Canton Network Scan "Updates" Visualiser'})]})})})}const m=t=>e.jsx(ee,{children:e.jsxs(te,{dateAdapter:ne,children:[e.jsx(je,{}),t.children]})}),pe={recordDate:new Date("2024-06-24T21:08:34.404896Z"),updateState:t=>{}},I=v.createContext(pe);var C=class extends Error{constructor(s){super(s.statusText);j(this,"headers");j(this,"url");j(this,"status");j(this,"statusText");j(this,"data");Object.setPrototypeOf(this,new.target.prototype),this.headers=s.headers,this.url=s.url,this.status=s.status,this.statusText=s.statusText,this.data=s.data}},B=t=>t==="post"||t==="put"||t==="patch"||t==="delete";function fe(t){const s=[],n=(i,r)=>`${encodeURIComponent(i)}=${encodeURIComponent(String(r))}`;return Object.keys(t).forEach(i=>{const r=t[i];r!=null&&(Array.isArray(r)?r.forEach(a=>s.push(n(i,a))):s.push(n(i,r)))}),s.length>0?`?${s.join("&")}`:""}function ge(t,s){return t.replace(/\{([^}]+)\}/g,(n,i)=>{const r=encodeURIComponent(s[i]);return delete s[i],r})}function me(t,s,n){let i={};return B(t)?n.forEach(r=>{i[r]=s[r],delete s[r]}):i={...s},fe(i)}function ve(t,s){const n=new Headers(s);return t!==void 0&&!n.has("Content-Type")&&n.append("Content-Type","application/json"),n.has("Accept")||n.append("Accept","application/json"),n}function ye(t,s){const n=B(t)?JSON.stringify(s):void 0;return t==="delete"&&n==="{}"?void 0:n}function be(t,s){const n=new Headers(t==null?void 0:t.headers),i=new Headers(s==null?void 0:s.headers);for(const r of i.keys()){const a=i.get(r);a!=null&&n.set(r,a)}return{...t,...s,headers:n}}function _e(t){var o;const s=Object.assign(Array.isArray(t.payload)?[]:{},t.payload),n=ge(t.path,s),i=me(t.method,s,t.queryParams),r=ye(t.method,s),a=ve(r,(o=t.init)==null?void 0:o.headers),c=t.baseUrl+n+i,d={...t.init,method:t.method.toUpperCase(),headers:a,body:r};return{url:c,init:d}}async function we(t){const s=t.headers.get("content-type");if(t.status===204||t.status===304)return;if(s&&s.indexOf("application/json")!==-1)return await t.json();const n=await t.text();try{return JSON.parse(n)}catch{return n}}async function Te(t,s){const n=await fetch(t,s),i=await we(n),r={headers:n.headers,url:n.url,ok:n.ok,status:n.status,statusText:n.statusText,data:i};if(r.ok)return r;throw new C(r)}function Se(t,s){const n=async(i,r,a)=>{if(t==null||i===t.length)return s(r,a);const c=t[i];return await c(r,a,(d,o)=>n(i+1,d,o))};return(i,r)=>n(0,i,r)}async function Ce(t){const{url:s,init:n}=_e(t);return await t.fetch(s,n)}function Oe(t){const s=async(n,i)=>{try{return await t(n,i)}catch(r){throw r instanceof C?new s.Error(r):r}};return s.Error=class extends C{constructor(n){super(n),Object.setPrototypeOf(this,new.target.prototype)}getActualType(){return{status:this.status,data:this.data}}},s}function Ee(){let t="",s={};const n=[],i=Se(n,Te);return{configure:r=>{t=r.baseUrl||"",s=r.init||{},n.splice(0),n.push(...r.use||[])},use:r=>n.push(r),path:r=>({method:a=>({create:c=>Oe((d,o)=>Ce({baseUrl:(o==null?void 0:o.baseUrl)??(typeof t=="function"?t():t),path:r,method:a,queryParams:Object.keys(c||{}),payload:d,init:be(s,o),fetch:i}))})})}}var L={for:()=>Ee()};function ke(t){return t.events_by_id!==void 0}function De(t){return t.create_arguments!==void 0}async function Ne(t){const s=L.for();s.configure({baseUrl:"https://scan.sv-2.global.canton.network.digitalasset.com/api/scan",init:{headers:{Accept:"application/json"},signal:AbortSignal.timeout(5e3)}});const n=s.path("/v1/updates/{update_id}").method("get").create(),{data:i}=await n({update_id:t});return i}async function Ae(t){const s=L.for();try{s.configure({baseUrl:"https://scan.sv-2.global.canton.network.digitalasset.com/api/scan",init:{headers:{Accept:"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(5e3)}});const n=s.path("/v1/updates").method("post").create();try{const{data:i}=await n(t);if(i)return i.transactions}catch(i){if(i instanceof n.Error){const r=i.getActualType();console.error("Error getting updates:",r),(r.status===400||r.status===500)&&console.error(r.data)}}}catch(n){throw console.error("An error occurred:",n),n}}function Ue(t){const{row:s}=t,[n,i]=v.useState(!1);return e.jsxs(v.Fragment,{children:[e.jsxs(p,{sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(l,{children:e.jsx(k,{"aria-label":"expand row",size:"small",onClick:()=>i(!n),children:n?e.jsx(ie,{}):e.jsx(ae,{})})}),e.jsx(l,{component:"th",scope:"row",children:e.jsx(P,{to:"/cn-visualiser/"+s.update_id,children:s.update_id})}),e.jsx(l,{align:"right",children:s.total_events}),e.jsx(l,{align:"right",children:s.migration_id}),e.jsx(l,{align:"right",children:s.record_time})]}),e.jsx(p,{children:e.jsx(l,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:e.jsx(ce,{in:n,timeout:"auto",unmountOnExit:!0,children:e.jsxs(U,{sx:{margin:1},children:[e.jsx(x,{variant:"h6",gutterBottom:!0,component:"div",children:"Event(s)"}),e.jsxs(D,{size:"small","aria-label":"purchases",children:[e.jsx(N,{children:e.jsxs(p,{children:[e.jsx(l,{children:"Event ID"}),e.jsx(l,{children:"Event Type"}),e.jsx(l,{children:"Template"}),e.jsx(l,{children:"Choice"})]})}),e.jsx(A,{children:s.events.map(r=>e.jsxs(p,{children:[e.jsx(l,{component:"th",scope:"row",children:r.event_id.split(":")[1]}),e.jsx(l,{children:r.event_type}),e.jsx(l,{children:r.template_id.split(":")[1]+":"+r.template_id.split(":")[2]}),e.jsx(l,{children:r.event_type==="exercised_event"&&r.choice})]},r.event_id))})]})]})})})})]})}function Pe(t){let s=[];for(const n in t.events_by_id){const i=t.events_by_id[n];s.push(i)}return s.sort((n,i)=>{const r=Number(n.event_id.split(":")[1]),a=Number(i.event_id.split(":")[1]);return r<a?-1:r>a?1:0}),{update_id:t.update_id,migration_id:t.migration_id,record_time:t.record_time,events:s,total_events:Object.keys(t.events_by_id).length}}const Re=()=>{const[t,s]=h.useState(void 0),[n,i]=h.useState(!0),[r,a]=h.useState(void 0),{recordDate:c,updateState:d}=h.useContext(I),[o,f]=h.useState(!0);if(h.useEffect(()=>{(async()=>{if(o)try{i(!0),a(""),f(!1);const g={0:{min:"2024-06-24T21:08:34.404896Z",max:"2024-10-16T13:00:18.826299Z"},1:{min:"2024-10-16T13:24:18.493744Z",max:"2024-12-11T14:00:17.064286Z"},2:{min:"2024-12-11T14:23:05.779294Z",max:"2025-05-23T19:02:45.315646Z"}};let S=0;if(c==null)return[];c>=new Date(g[2].min)?S=2:c>=new Date(g[1].min)&&(S=1);const z={after:{after_record_time:c.toISOString(),after_migration_id:S},page_size:100,daml_value_encoding:"compact_json"},H=await Ae(z);s(H)}catch(g){a(R(g))}finally{i(!1)}})()},[o,c]),r)return e.jsx(m,{children:e.jsxs("p",{children:["Errors occurred: ",r]})});let w;t?w=t.map(u=>Pe(u)):w=[];const W=u=>{Object.prototype.toString.call(u)==="[object Date]"&&(u==null||d({recordDate:u}))},J=()=>{c&&f(!0)};return e.jsxs(m,{children:[e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsx("div",{children:'This application allows you to search and view Canton Network Scan "Updates". You need to use from a machine with access to Canton Network Scan service.'})}),e.jsx("p",{}),e.jsxs(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:["Enter Record Datetime to search for:",e.jsx(se,{label:"Date and Time",value:c,onChange:W,onAccept:J,ampm:!1,format:"yyyy-MM-dd HH:mm:ss"})]}),e.jsx(re,{component:y,children:e.jsxs(D,{"aria-label":"collapsible table",children:[e.jsx(N,{children:e.jsxs(p,{children:[e.jsx(l,{}),e.jsx(l,{children:"Update ID#"}),e.jsx(l,{align:"right",children:"Event Count"}),e.jsx(l,{align:"right",children:"Migration ID"}),e.jsx(l,{align:"right",children:"Date"})]})}),e.jsx(A,{children:n?e.jsx(p,{children:e.jsx(l,{colSpan:4,align:"center",children:"Loading..."})}):w&&w.map(u=>e.jsx(Ue,{row:u},u.update_id))})]})})]})},Ie=(t={x:0,y:0})=>{const[s,n]=h.useState(t),[i,r]=h.useState({width:0,height:0}),a=h.useCallback(c=>{if(c!==null){const{width:d,height:o}=c.getBoundingClientRect();r({width:d,height:o}),n({x:d/2-400,y:o/2})}},[]);return[i,s,a]},Be=({nodeDatum:t,toggleNode:s})=>{var n,i,r,a,c,d,o,f;return e.jsxs("g",{children:[e.jsx("rect",{width:"15",height:"15",x:"-5",onClick:s}),e.jsx("text",{fill:"black",strokeWidth:"1",x:"0",dy:"40",children:t.name}),t.attributes&&((n=t.attributes)==null?void 0:n.type)&&e.jsxs("text",{fill:"black",x:"20",dy:"60",strokeWidth:"1",children:["Type: ",(i=t.attributes)==null?void 0:i.type]}),t.attributes&&((r=t.attributes)==null?void 0:r.update_id)&&e.jsxs("text",{fill:"black",x:"20",dy:"60",strokeWidth:"1",children:["Upd ID: ",(a=t.attributes)==null?void 0:a.update_id]}),t.attributes&&((c=t.attributes)==null?void 0:c.template)&&e.jsxs("text",{fill:"black",x:"20",dy:"80",strokeWidth:"1",children:["Template: ",(d=t.attributes)==null?void 0:d.template]}),t.attributes&&((o=t.attributes)==null?void 0:o.choice)&&e.jsxs("text",{fill:"black",x:"20",dy:"100",strokeWidth:"1",children:["Choice: ",(f=t.attributes)==null?void 0:f.choice]})]})},F=(t,s)=>{const n=s[t],r={name:t.substring(0,10)+"....."+t.substring(t.length-10),attributes:{},children:[]};return r.attributes={},r.attributes.type=n.event_type,r.attributes.template=n.template_id.substring(n.template_id.indexOf(":")+1),n.event_type=="exercised_event"&&(r.attributes.choice=n.choice),n.child_event_ids!==void 0&&(r.children=n.child_event_ids.map(a=>F(a,s))),r},Le=t=>{var n;const s={name:"TX Root",children:[],attributes:{update_id:t.update_id.substring(0,10)+"....."+t.update_id.substring(t.update_id.length-10)}};if(typeof t.root_event_ids!==void 0){const i=t;s.children=(n=i.root_event_ids)==null?void 0:n.map(r=>F(r,i.events_by_id))}return s},Fe=({source:t,target:s})=>{const n=t.y,i=t.x+10,r=s.y,a=s.x+10;return`M${n},${i}L${r},${a}`},Me=t=>{const[s,n,i]=Ie(),r={width:"1000px",height:"600px",border:"2px solid gray"},a=Le(t.transaction);return e.jsx("div",{style:r,ref:i,children:e.jsx($,{data:a,dimensions:s,translate:n,nodeSize:{x:350,y:150},renderCustomNodeElement:Be,orientation:"horizontal",pathFunc:Fe})})};function We(t){const[s,n]=h.useState(!1);function i(){n(r=>!r)}return e.jsxs("div",{children:[e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsxs("div",{onClick:i,children:["Raw JSON ",e.jsx("strong",{children:"(click to show/hide)"})]})}),s&&e.jsx("pre",{children:JSON.stringify(t.transaction,null,2)}),e.jsx("p",{}),e.jsx("p",{}),e.jsx("p",{})]})}const T=t=>{let s;const n=[];for(s in t.field){const i=t.field[s];switch(typeof t.field[s]){case"string":typeof i=="string"&&n.push(e.jsxs("li",{children:[e.jsx("em",{children:s}),": ",i]},s));break;case"boolean":n.push(e.jsxs("li",{children:[e.jsx("em",{children:s}),": ",i?"True":"False"]},s));break;case"object":n.push(e.jsxs("li",{children:[e.jsx("em",{children:s}),": ",e.jsx("ul",{children:e.jsx(T,{field:i})})]},s));break;default:n.push(e.jsx("li",{children:"Unknown Field Type"},s));break}}return n},M=t=>{var s,n,i,r;if(De(t.events[t.id])){const a=t.events[t.id];return e.jsx(y,{elevation:2,children:e.jsx(b,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsx("div",{children:e.jsxs("strong",{children:['"',t.id,'": ',a.event_type,"  "]})}),e.jsxs("div",{children:["Package: ",a.template_id]}),e.jsx("div",{children:"Signatories:"}),e.jsxs("ul",{children:[a.signatories.length==0&&e.jsx("li",{children:"None"}),a.signatories&&((s=a.signatories)==null?void 0:s.map(c=>e.jsx("li",{children:c},c)))]}),e.jsx("div",{children:"Observers:"}),e.jsxs("ul",{children:[a.observers.length==0&&e.jsx("li",{children:"None"}),a.observers&&((n=a.observers)==null?void 0:n.map(c=>e.jsx("li",{children:c},c)))]}),e.jsx("div",{children:"Create Arguments: "}),e.jsx("ul",{children:e.jsx(T,{field:a.create_arguments})})]})})})}else{const a=t.events[t.id];return e.jsx(y,{elevation:2,children:e.jsx(b,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsx("div",{children:e.jsxs("strong",{children:[t.id,": ",a.event_type," "]})}),e.jsxs("div",{children:["Package: ",a.template_id]}),e.jsxs("div",{children:["Consuming: ",e.jsx("strong",{children:a.consuming?e.jsx(e.Fragment,{children:"True"}):e.jsx(e.Fragment,{children:"False"})})]}),e.jsx("div",{children:"Acting Parties:"}),e.jsxs("ul",{children:[a.acting_parties.length==0&&e.jsx("li",{children:"None"}),a.acting_parties&&((i=a.acting_parties)==null?void 0:i.map(c=>e.jsx("li",{children:c},c)))]}),e.jsxs("div",{children:["Choice: ",e.jsx("strong",{children:a.choice})]}),e.jsx("div",{children:"Choice Arguments: "}),e.jsx("ul",{children:e.jsx(T,{field:a.choice_argument})}),e.jsx("div",{children:"Exercise Result: "}),e.jsx("ul",{children:e.jsx(T,{field:a.exercise_result})}),e.jsx("div",{children:"Child Events:"}),e.jsxs("ul",{children:[a.child_event_ids.length==0&&e.jsx("li",{children:"None"}),a.child_event_ids&&((r=a.child_event_ids)==null?void 0:r.map(c=>e.jsx("div",{className:"list-row",children:e.jsx("li",{children:e.jsx(M,{id:c,events:t.events},c)})},c)))]})]})})})}},Je=t=>{var s;if(ke(t.transaction)){const n=t.transaction;return e.jsx(y,{elevation:2,children:e.jsx(b,{sx:{minWidth:275},children:e.jsx(_,{children:e.jsxs("div",{className:"box-with-outline",children:[e.jsxs(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:[e.jsx("label",{children:e.jsx("strong",{children:"Transaction:"})}),e.jsx("p",{})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Update ID:"})," ",n.update_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Workflow ID:"})," ",n.workflow_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Record Time:"})," ",n.record_time]}),e.jsxs("div",{children:[e.jsx("label",{children:"Migration ID:"})," ",n.migration_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Synchronizer ID:"})," ",n.synchronizer_id]}),e.jsx("p",{}),n.root_event_ids&&((s=n.root_event_ids)==null?void 0:s.map(i=>e.jsx("div",{className:"list-row",children:e.jsx(M,{id:i,events:n.events_by_id},i)},i)))]})})})})}else{const n=t.transaction;return e.jsxs("div",{children:["TODO:  To be Handled ",n.update_id]})}},ze=()=>{const[t,s]=h.useState(),{update_id:n}=oe(),[i,r]=v.useState(""),[a,c]=v.useState(!1);return h.useEffect(()=>{(async()=>{c(!0),r("");try{let o;typeof n=="string"&&(o=await Ne(n),s(o))}catch(o){r("ERROR: Error retrieving data from service: "+R(o))}finally{c(!1)}})()},[n]),a?e.jsx(m,{children:e.jsx("p",{children:"Loading data..."})}):i?e.jsx(m,{children:e.jsxs("p",{children:["Error: ",i]})}):e.jsxs(m,{children:[e.jsx(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsx("strong",{children:"Transaction Details Page"})}),e.jsx(U,{sx:{display:"flex",flexWrap:"wrap","& > :not(style)":{m:1}},children:e.jsx(y,{children:e.jsx(b,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsxs(x,{variant:"h6",component:"div",sx:{flexGrow:1},children:[e.jsx("strong",{children:"Details for Update ID: "}),n]}),e.jsx("p",{}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{transaction:t}),e.jsx(b,{sx:{minWidth:275},children:e.jsx(_,{children:e.jsx(We,{transaction:t})})}),e.jsx(Je,{transaction:t})]})]})})})})]})},He=()=>e.jsx(le,{children:e.jsxs(de,{children:[e.jsx(E,{path:"/cn-visualiser",element:e.jsx(Re,{})}),e.jsx(E,{path:"/cn-visualiser/:update_id",element:e.jsx(ze,{})})]})}),Ze=t=>{const[s,n]=h.useState({recordDate:new Date("2024-06-24T00:00:00.000000Z")}),i=r=>{r.recordDate&&n({recordDate:r.recordDate})};return e.jsx(I.Provider,{value:{...s,updateState:i},children:t.children})};K.createRoot(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(Ze,{children:e.jsx(He,{})})}));
