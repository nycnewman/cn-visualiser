import{j as e,a9 as g,aa as D,r as d,ab as Z,ac as G}from"./vendor-Dqb_frkM.js";import{c as J,i as S,T as H,A as K,a as $,I as k,M as X,b as u,C as Y,L as q,d as V,D as Q,B as ee,e as te,P as m,f as E,g as N,h as j,j as l,k as O,K as se,l as ne,m as ie,n as R,o as v,p as _}from"./@mui-DwSq7x91.js";import{L as A,u as re,B as ae,R as ce,a as C}from"./@react-router-BYQgSiax.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function le(t){return typeof t=="object"&&t!==null&&"message"in t&&typeof t.message=="string"}function de(t){if(le(t))return t;try{return new Error(JSON.stringify(t))}catch{return new Error(String(t))}}function P(t){return de(t).message}const oe=J({palette:{primary:{main:S[500]},secondary:{main:S[700]}}});function he(){return e.jsx(H,{theme:oe,children:e.jsx(K,{position:"static",children:e.jsxs($,{children:[e.jsx(k,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},children:e.jsx(A,{to:"/cn-visualiser/",children:e.jsx(X,{})})}),e.jsx(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:'Canton Network Scan "Updates" Visualiser'})]})})})}const y=t=>e.jsx(Y,{children:e.jsxs(q,{dateAdapter:V,children:[e.jsx(he,{}),t.children]})}),xe={recordDate:new Date("2024-06-24T21:08:34.404896Z"),updateState:t=>{}},L=g.createContext(xe);function ue(t){return t.events_by_id!==void 0}function je(t){return t.create_arguments!==void 0}async function pe(t){const i=D.for();i.configure({baseUrl:"https://scan.sv-2.global.canton.network.digitalasset.com/api/scan",init:{headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)}});const n=i.path("/v1/updates/{update_id}").method("get").create(),{data:a}=await n({update_id:t});return a}async function fe(t){const i=D.for();i.configure({baseUrl:"https://scan.sv-2.global.canton.network.digitalasset.com/api/scan",init:{headers:{Accept:"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(1e4)}});const n=i.path("/v1/updates").method("post").create();try{const{data:a}=await n(t);if(a)return a.transactions}catch(a){if(console.error("An error occurred:",a),a instanceof n.Error){const s=a.getActualType();console.error("Error getting updates:",s),(s.status===400||s.status===500)&&console.error(s.data)}throw a}}function ge(t){const{row:i}=t,[n,a]=g.useState(!1);return e.jsxs(g.Fragment,{children:[e.jsxs(j,{sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(l,{children:e.jsx(k,{"aria-label":"expand row",size:"small",onClick:()=>a(!n),children:n?e.jsx(se,{}):e.jsx(ne,{})})}),e.jsxs(l,{component:"th",scope:"row",children:[e.jsxs(A,{to:"/cn-visualiser/"+i.update_id,children:[i.update_id," "]}),e.jsx("p",{})," ",e.jsx("ul",{children:i.titles.map((s,r)=>e.jsx("li",{children:s},r))})]}),e.jsx(l,{align:"right",children:i.total_events}),e.jsx(l,{align:"right",children:i.migration_id}),e.jsx(l,{align:"right",children:i.record_time})]}),e.jsx(j,{children:e.jsx(l,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:e.jsx(ie,{in:n,timeout:"auto",unmountOnExit:!0,children:e.jsxs(R,{sx:{margin:1},children:[e.jsx(u,{variant:"h6",gutterBottom:!0,component:"div",children:"Event(s)"}),e.jsxs(E,{size:"small","aria-label":"purchases",children:[e.jsx(N,{children:e.jsxs(j,{children:[e.jsx(l,{children:"Event ID"}),e.jsx(l,{children:"Event Type"}),e.jsx(l,{children:"Template"}),e.jsx(l,{children:"Choice"})]})}),e.jsx(O,{children:i.events.map(s=>e.jsxs(j,{children:[e.jsx(l,{component:"th",scope:"row",children:s.event_id.split(":")[1]}),e.jsx(l,{children:s.event_type}),e.jsx(l,{children:s.template_id.split(":")[1]+":"+s.template_id.split(":")[2]}),e.jsx(l,{children:s.event_type==="exercised_event"&&s.choice})]},s.event_id))})]})]})})})})]})}function me(t){let i=[];for(const a in t.events_by_id){const s=t.events_by_id[a];i.push(s)}let n=[];for(const a in t.root_event_ids){const s=t.events_by_id[t.root_event_ids[a]];let r=s.template_id.split(":")[2];s.event_type=="exercised_event"&&(r=r+" - "+s.choice),n.push(r)}return i.sort((a,s)=>{const r=Number(a.event_id.split(":")[1]),c=Number(s.event_id.split(":")[1]);return r<c?-1:r>c?1:0}),{update_id:t.update_id,titles:n,migration_id:t.migration_id,record_time:t.record_time,events:i,total_events:Object.keys(t.events_by_id).length}}const ve=()=>{const[t,i]=d.useState(void 0),[n,a]=d.useState(!0),[s,r]=d.useState(void 0),{recordDate:c,updateState:h}=d.useContext(L),[o,p]=d.useState(!0);d.useEffect(()=>{(async()=>{if(o)try{a(!0),r(""),p(!1);const f={0:{min:"2024-06-24T21:08:34.404896Z",max:"2024-10-16T13:00:18.826299Z"},1:{min:"2024-10-16T13:24:18.493744Z",max:"2024-12-11T14:00:17.064286Z"},2:{min:"2024-12-11T14:23:05.779294Z",max:"2025-05-23T19:02:45.315646Z"}};let T=0;if(c==null)return[];c>=new Date(f[2].min)?T=2:c>=new Date(f[1].min)&&(T=1);const M={after:{after_record_time:c.toISOString(),after_migration_id:T},page_size:25,daml_value_encoding:"compact_json"},z=await fe(M);i(z)}catch(f){r(P(f))}finally{a(!1)}})()},[o,c]);let b;t?b=t.map(x=>me(x)):b=[];const U=x=>{Object.prototype.toString.call(x)==="[object Date]"&&(x==null||h({recordDate:x}))},W=()=>{c&&p(!0)},F=()=>{t!=null&&(h({recordDate:new Date(t[t.length-1].record_time.toString())}),p(!0))};return e.jsxs(y,{children:[e.jsx(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsx("div",{children:'This application allows you to search and view Canton Network Scan "Updates". You need to use from a machine with access to Canton Network Scan service.'})}),e.jsx("p",{}),e.jsxs(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:["Enter Record Datetime to search for:",e.jsx(Q,{label:"Date and Time",value:c,onChange:U,onAccept:W,ampm:!1,format:"yyyy-MM-dd HH:mm:ss"}),"  ",e.jsx(ee,{variant:"contained",onClick:F,children:"Next Page"})]}),e.jsx(te,{component:m,children:e.jsxs(E,{"aria-label":"collapsible table",children:[e.jsx(N,{children:e.jsxs(j,{children:[e.jsx(l,{}),e.jsxs(l,{children:["Update ID# ",e.jsx("p",{}),e.jsx("ul",{children:e.jsx("li",{children:"Root Events"})})," "]}),e.jsx(l,{align:"right",children:"Event Count"}),e.jsx(l,{align:"right",children:"Migration ID"}),e.jsx(l,{align:"right",children:"Date"})]})}),e.jsxs(O,{children:[n&&e.jsx(j,{children:e.jsx(l,{colSpan:4,align:"center",children:"Loading..."})}),s&&e.jsx(j,{children:e.jsxs(l,{colSpan:4,align:"center",children:["ERROR: Error occurred: ... ",s," "]})}),b&&b.map(x=>e.jsx(ge,{row:x},x.update_id))]})]})})]})},_e=(t={x:0,y:0})=>{const[i,n]=d.useState(t),[a,s]=d.useState({width:0,height:0}),r=d.useCallback(c=>{if(c!==null){const{width:h,height:o}=c.getBoundingClientRect();s({width:h,height:o}),n({x:h/2-400,y:o/2})}},[]);return[a,i,r]},be=({nodeDatum:t,toggleNode:i})=>{var n,a,s,r,c,h,o,p;return e.jsxs("g",{children:[e.jsx("rect",{width:"15",height:"15",x:"-5",onClick:i}),e.jsx("text",{fill:"black",strokeWidth:"1",x:"0",dy:"40",children:t.name}),t.attributes&&((n=t.attributes)==null?void 0:n.type)&&e.jsxs("text",{fill:"black",x:"20",dy:"60",strokeWidth:"1",children:["Type: ",(a=t.attributes)==null?void 0:a.type]}),t.attributes&&((s=t.attributes)==null?void 0:s.update_id)&&e.jsxs("text",{fill:"black",x:"20",dy:"60",strokeWidth:"1",children:["Upd ID: ",(r=t.attributes)==null?void 0:r.update_id]}),t.attributes&&((c=t.attributes)==null?void 0:c.template)&&e.jsxs("text",{fill:"black",x:"20",dy:"80",strokeWidth:"1",children:["Template: ",(h=t.attributes)==null?void 0:h.template]}),t.attributes&&((o=t.attributes)==null?void 0:o.choice)&&e.jsxs("text",{fill:"black",x:"20",dy:"100",strokeWidth:"1",children:["Choice: ",(p=t.attributes)==null?void 0:p.choice]})]})},B=(t,i)=>{const n=i[t],s={name:t.substring(0,10)+"....."+t.substring(t.length-10),attributes:{},children:[]};return s.attributes={},s.attributes.type=n.event_type,s.attributes.template=n.template_id.substring(n.template_id.indexOf(":")+1),n.event_type=="exercised_event"&&(s.attributes.choice=n.choice),n.child_event_ids!==void 0&&(s.children=n.child_event_ids.map(r=>B(r,i))),s},ye=t=>{var n;const i={name:"TX Root",children:[],attributes:{update_id:t.update_id.substring(0,10)+"....."+t.update_id.substring(t.update_id.length-10)}};if(typeof t.root_event_ids!==void 0){const a=t;i.children=(n=a.root_event_ids)==null?void 0:n.map(s=>B(s,a.events_by_id))}return i},we=({source:t,target:i})=>{const n=t.y,a=t.x+10,s=i.y,r=i.x+10;return`M${n},${a}L${s},${r}`},Te=t=>{const[i,n,a]=_e(),s={width:"1000px",height:"600px",border:"2px solid gray"},r=ye(t.transaction);return e.jsx("div",{style:s,ref:a,children:e.jsx(Z,{data:r,dimensions:i,translate:n,nodeSize:{x:350,y:150},renderCustomNodeElement:be,orientation:"horizontal",pathFunc:we})})};function Se(t){const[i,n]=d.useState(!1);function a(){n(s=>!s)}return e.jsxs("div",{children:[e.jsx(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsxs("div",{onClick:a,children:["Raw JSON ",e.jsx("strong",{children:"(click to show/hide)"})]})}),i&&e.jsx("pre",{children:JSON.stringify(t.transaction,null,2)}),e.jsx("p",{}),e.jsx("p",{}),e.jsx("p",{})]})}const w=t=>{if(typeof t.field=="string")return e.jsxs("li",{children:['"',t.field,'"']},t.field);let i;const n=[];for(i in t.field){const a=t.field[i];switch(typeof t.field[i]){case"string":typeof a=="string"&&n.push(e.jsxs("li",{children:[e.jsx("em",{children:i}),": ",a]},i));break;case"boolean":n.push(e.jsxs("li",{children:[e.jsx("em",{children:i}),": ",a?"True":"False"]},i));break;case"object":n.push(e.jsxs("li",{children:[e.jsx("em",{children:i}),": ",e.jsx("ul",{children:e.jsx(w,{field:a})})]},i));break;default:n.push(e.jsx("li",{children:"Unknown Field Type"},i));break}}return n},I=t=>{var i,n,a,s;if(je(t.events[t.id])){const r=t.events[t.id];return e.jsx(m,{elevation:2,children:e.jsx(v,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsx("div",{children:e.jsxs("strong",{children:['"',t.id,'": ',r.event_type,"  "]})}),e.jsxs("div",{children:["Package: ",r.template_id]}),e.jsxs("div",{children:["Created At: ",r.created_at]}),e.jsx("div",{children:"Signatories:"}),e.jsxs("ul",{children:[r.signatories.length==0&&e.jsx("li",{children:"None"}),r.signatories&&((i=r.signatories)==null?void 0:i.map(c=>e.jsx("li",{children:c},c)))]}),e.jsx("div",{children:"Observers:"}),e.jsxs("ul",{children:[r.observers.length==0&&e.jsx("li",{children:"None"}),r.observers&&((n=r.observers)==null?void 0:n.map(c=>e.jsx("li",{children:c},c)))]}),e.jsx("div",{children:"Create Arguments: "}),e.jsx("ul",{children:e.jsx(w,{field:r.create_arguments})})]})})})}else{const r=t.events[t.id];return e.jsx(m,{elevation:2,children:e.jsx(v,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsx("div",{children:e.jsxs("strong",{children:[t.id,": ",r.event_type," "]})}),e.jsxs("div",{children:["Package: ",r.template_id]}),e.jsxs("div",{children:["Consuming: ",e.jsx("strong",{children:r.consuming?e.jsx(e.Fragment,{children:"True"}):e.jsx(e.Fragment,{children:"False"})})]}),e.jsx("div",{children:"Acting Parties:"}),e.jsxs("ul",{children:[r.acting_parties.length==0&&e.jsx("li",{children:"None"}),r.acting_parties&&((a=r.acting_parties)==null?void 0:a.map(c=>e.jsx("li",{children:c},c)))]}),e.jsxs("div",{children:["Choice: ",e.jsx("strong",{children:r.choice})]}),e.jsx("div",{children:"Choice Arguments: "}),e.jsx("ul",{children:e.jsx(w,{field:r.choice_argument})}),e.jsx("div",{children:"Exercise Result: "}),e.jsx("ul",{children:e.jsx(w,{field:r.exercise_result})}),e.jsx("div",{children:"Child Events:"}),e.jsxs("ul",{children:[r.child_event_ids.length==0&&e.jsx("li",{children:"None"}),r.child_event_ids&&((s=r.child_event_ids)==null?void 0:s.map(c=>e.jsx("div",{className:"list-row",children:e.jsx("li",{children:e.jsx(I,{id:c,events:t.events},c)})},c)))]})]})})})}},Ce=t=>{var i;if(ue(t.transaction)){const n=t.transaction;return e.jsx(m,{elevation:2,children:e.jsx(v,{sx:{minWidth:275},children:e.jsx(_,{children:e.jsxs("div",{className:"box-with-outline",children:[e.jsxs(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:[e.jsx("label",{children:e.jsx("strong",{children:"Transaction:"})}),e.jsx("p",{})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Update ID:"})," ",n.update_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Workflow ID:"})," ",n.workflow_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Record Time:"})," ",n.record_time]}),e.jsxs("div",{children:[e.jsx("label",{children:"Migration ID:"})," ",n.migration_id]}),e.jsxs("div",{children:[e.jsx("label",{children:"Synchronizer ID:"})," ",n.synchronizer_id]}),e.jsx("p",{}),n.root_event_ids&&((i=n.root_event_ids)==null?void 0:i.map(a=>e.jsx("div",{className:"list-row",children:e.jsx(I,{id:a,events:n.events_by_id},a)},a)))]})})})})}else{const n=t.transaction;return e.jsxs("div",{children:["TODO:  To be Handled ",n.update_id]})}},De=()=>{const[t,i]=d.useState(),{update_id:n}=re(),[a,s]=g.useState(""),[r,c]=g.useState(!1);return d.useEffect(()=>{(async()=>{c(!0),s("");try{let o;typeof n=="string"&&(o=await pe(n),i(o))}catch(o){s("ERROR: Error retrieving data from service: "+P(o))}finally{c(!1)}})()},[n]),r?e.jsx(y,{children:e.jsx("p",{children:"Loading data..."})}):a?e.jsx(y,{children:e.jsxs("p",{children:["Error: ",a]})}):e.jsxs(y,{children:[e.jsx(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:e.jsx("strong",{children:"Transaction Details Page"})}),e.jsx(R,{sx:{display:"flex",flexWrap:"wrap","& > :not(style)":{m:1}},children:e.jsx(m,{children:e.jsx(v,{sx:{minWidth:275},children:e.jsxs(_,{children:[e.jsxs(u,{variant:"h6",component:"div",sx:{flexGrow:1},children:[e.jsx("strong",{children:"Details for Update ID: "}),n]}),e.jsx("p",{}),t&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{transaction:t}),e.jsx(v,{sx:{minWidth:275},children:e.jsx(_,{children:e.jsx(Se,{transaction:t})})}),e.jsx(Ce,{transaction:t})]})]})})})})]})},ke=()=>e.jsx(ae,{children:e.jsxs(ce,{children:[e.jsx(C,{path:"/cn-visualiser",element:e.jsx(ve,{})}),e.jsx(C,{path:"/cn-visualiser/:update_id",element:e.jsx(De,{})})]})}),Ee=t=>{const[i,n]=d.useState({recordDate:new Date("2024-06-24T00:00:00.000000Z")}),a=s=>{s.recordDate&&n({recordDate:s.recordDate})};return e.jsx(L.Provider,{value:{...i,updateState:a},children:t.children})};G.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(Ee,{children:e.jsx(ke,{})})}));
